
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="import" href="../components/sylver-viz.html">


<dom-module id="sylver-app">

  <template>

    <style>

      :host {
        
      }

      #content {
        @apply --layout-horizontal;
        @apply --layout-justified;
        margin: 20px;
      }

      #viz-panel {
        width: 70%;
      }

      #input-panel {
        width: 30%;
      }

      #error {
        color: red;
      }

    </style>

    <div id="content">

      <div id="viz-panel">
        <sylver-viz
          details="[[details]]"
          mod="[[details.multiplicity]]"
          on-number-selected="_handleNumberSelected">
        </sylver-viz>
      </div>

      <div id="info-panel">

        <div id="input-panel">
          <paper-input id="l-input" value="8,25"></paper-input>
          <paper-input id="length-input" value="1000"></paper-input>
          <paper-checkbox id="find-gaps-checkbox" checked></paper-checkbox>
          <paper-button on-tap="_getDetails">Hi Ho Sylver!</paper-button>
          <paper-button on-tap="_undo">Undo</paper-button>
        </div>

        <div id="summary-panel">
          generators: [[details.generators]] <br/>
          frobenius: [[details.frobenius]] <br/>
          genus: [[details.genus]] <br/>
          is_irreducible: [[details.is_irreducible]] <br/>
          irreducible_type: [[details.irreducible_type]] <br/>
          lonely_gaps: [[details.lonely_gaps]] <br/>
          <br/>
          <span id="error">[[details.error]]</span>
        </div>
      
      </div>

    </div>

  </template>

  <script>

    class SylverApp extends Polymer.Element {

      static get is() { return 'sylver-app'; }

      static get properties() {
        return {

          details: {
            type: Object,
          },

        }
      }

      static get observers() {
        return [
          
        ]
      }

			ready() {
				super.ready();
			}

      _getDetails() {

        // Gather query values
        var query = {
          l: this.shadowRoot.querySelector("#l-input").value.split(",").map(Number),
          length: Number(this.shadowRoot.querySelector("#length-input").value),
          find_gaps: this.shadowRoot.querySelector("#find-gaps-checkbox").checked,
        }

        // Send the request
        console.log("Requesting details...");
        var req = new XMLHttpRequest();
        req.onreadystatechange = function() {
          if (req.readyState == 4 && req.status == 200) {
            // Set the details
            var res = JSON.parse(req.responseText);
            console.log("Received response: ", res);
            this.set("details", res);
          }
        }.bind(this);
        req.open("POST", "/get_details", true);
        req.setRequestHeader("content-type", "application/json");
        req.send(JSON.stringify(query))
      
      }

      _handleNumberSelected(e) {
        var lInput = this.shadowRoot.querySelector("#l-input");
        lInput.value = lInput.value+","+e.detail.number;
        this._getDetails();
      }

      _undo() {
        var lInput = this.shadowRoot.querySelector("#l-input");
        var l = lInput.value.split(",");
        lInput.value = l.slice(0,l.length-1).join(",");
        this._getDetails();
      }

    }

    window.customElements.define(SylverApp.is, SylverApp);

	</script>
	
</dom-module>
